<div id="announcementBar" style="  
  position:sticky;  
  top:0;  
  z-index:9999;  
  width:100%;  
  height:60px;  
  background:transparent;  
  color:#000;  
  font-size:18px;  
  font-weight:600;  
  font-family:'Segoe UI', Roboto, sans-serif;  
  text-align:center;  
  line-height:60px;  
  overflow:hidden;  
  white-space:nowrap;  
  cursor:grab;  
">  
  <div id="announcementWrapper" style="  
    display:inline-block;  
    white-space:nowrap;  
    will-change:transform;  
  ">  
    <span id="announcementContent"></span>  
    <span id="announcementContentClone"></span>  
  </div>  
</div>  

<style>   
.flash-here {  
  color: red;  
  font-weight: bold;  
  text-decoration: underline;  
  animation: flash 1s infinite;  
}  
@keyframes flash {  
  0%, 100% { color: red; }  
  50% { color: blue; }  
}  

/* Remove blue flash when clicking/tapping announcements */
#announcementBar,
#announcementBar * {
  -webkit-tap-highlight-color: transparent; /* mobile tap highlight */
  outline: none !important;                  /* remove focus outline */
  user-select: none;                         /* optional: prevent text selection */
}
</style>  

<script>  
// ---- ANNOUNCEMENTS ----  
const announcements = [  
  { owner: "PickMe Services", content: "üöñ PickMe Services is now available in Agogo!", phone: "+233534742142", plan: "Monthly", added: "2025-09-01", expiry: "" },  
  { owner: "PickMe Services", content: "üõçÔ∏è Shop from your favorite vendors ‚Äî Fast & Easy!", phone: "+233534742142", plan: "Quarterly", added: "2025-08-15", expiry: "" },  
  { owner: "PickMe Services", content: "üè® Book hotels, Guesthouses, Airbnb, Hostel rent, Store rent & House rent directly on PickMe Services!", phone: "+233534742142", plan: "Semi-Annual", added: "2025-07-01", expiry: "" },  
  { owner: "WOO ENTERTAINMENT", content: "‚ú® WOO ENTERTAINMENT is bringing to you the AGOGO NA ME FRI Season 26. Watch Out!!!", phone: "+233534742142", expiry: "2025-09-20" },  
  { owner: "Manko Pub", content: "üé§ KWAKU FLICK is repping live at Manko Pub on 5th September, 2025. Don't miss it.", phone: "+233534742142", plan: "Annual", added: "2025-01-01", expiry: "" },  
  { owner: "New Promo", content: "üî• Big promo ongoing, don‚Äôt miss out!", phone: "+233534742142", plan: "Monthly", added: "2025-08-10", expiry: "" },  
  { owner: "Extra 1", content: "üì¢ This is a test announcement number 7", phone: "+233534742142" },  
  { owner: "Extra 2", content: "üì¢ Another message number 8", phone: "+233534742142" },  
  { owner: "Extra 3", content: "üì¢ Testing scrolling smoothness 9", phone: "+233534742142" },  
  { owner: "Extra 4", content: "üì¢ Sample text number 10", phone: "+233534742142" },  
  { owner: "Extra 5", content: "üì¢ Announcement number 11", phone: "+233534742142" },  
  { owner: "Extra 6", content: "üì¢ Announcement number 12", phone: "+233534742142" },  
  { owner: "Extra 7", content: "üì¢ Announcement number 13", phone: "+233534742142" }  
];  

// ---- EXPIRY CALCULATOR ----  
function getExpiryDate(item) {  
  if (item.expiry) return new Date(item.expiry);  
  if (!item.plan || !item.added) return null;  
  const addedDate = new Date(item.added);  
  switch (item.plan.toLowerCase()) {  
    case "monthly": addedDate.setMonth(addedDate.getMonth() + 1); break;  
    case "quarterly": addedDate.setMonth(addedDate.getMonth() + 3); break;  
    case "semi-annual":  
    case "semi-annually": addedDate.setMonth(addedDate.getMonth() + 6); break;  
    case "annual":  
    case "annually": addedDate.setFullYear(addedDate.getFullYear() + 1); break;  
  }  
  return addedDate;  
}  

// ---- FILTER ACTIVE ANNOUNCEMENTS ----  
const today = new Date();  
let activeAnnouncements = announcements.filter(a => {  
  const expiryDate = getExpiryDate(a);  
  return !expiryDate || today <= expiryDate;  
});  

// ---- RANDOMIZE ORDER ----  
activeAnnouncements = activeAnnouncements  
  .map(a => ({ a, r: Math.random() }))  
  .sort((x, y) => x.r - y.r)  
  .map(({ a }) => a);  

// ---- Insert "Click HERE" after every 5 (wrapping remainder) ----  
function buildFinalList(arr) {  
  const result = [];  
  let count = 0;  
  for (let i = 0; i < arr.length; i++) {  
    result.push({ text: arr[i].content, owner: arr[i].owner, phone: arr[i].phone });  
    count++;  
    if (count === 5) {  
      result.push({ text: `üì¢ Want to advertise? <a href="YOUR_FORM_LINK_HERE" class="flash-here">Click HERE to add your announcement</a>` });  
      count = 0;  
    }  
  }  
  if (count > 0) {  
    for (let j = 0; j < 5 - count; j++) {  
      result.push({ text: arr[j].content, owner: arr[j].owner, phone: arr[j].phone });  
    }  
    result.push({ text: `üì¢ Want to advertise? <a href="https://sites.google.com/view/pickmeservices/add-announcement-payment?authuser=0" class="flash-here">Click HERE to add your announcement</a>` });  
  }  
  return result;  
}  

const finalList = buildFinalList(activeAnnouncements);  

// ---- Add to DOM with duplicate for seamless scroll ----  
const contentEl = document.getElementById("announcementContent");  
const cloneEl = document.getElementById("announcementContentClone");  
const separator = " &nbsp;&nbsp; ‚Ä¢ &nbsp;&nbsp; ";  

function renderAnnouncements(list, el) {  
  el.innerHTML = list.map(item => {  
    if (item.owner && item.phone) {  
      return `<span class="clickable-announcement" data-owner="${item.owner}" data-content="${item.text}" data-phone="${item.phone}" style="cursor:pointer;">${item.text}</span>`;  
    } else {  
      return item.text;  
    }  
  }).join(separator) + separator;  
}  

renderAnnouncements(finalList, contentEl);  
renderAnnouncements(finalList, cloneEl);  

// ---- Auto-scroll + drag support ----  
const wrapper = document.getElementById("announcementWrapper");  
let posX = 0;  
let speed = 1;  
let isDragging = false, startX = 0;  
const contentWidth = contentEl.offsetWidth;  

function animate() {  
  if (!isDragging) posX -= speed;  
  if (Math.abs(posX) >= contentWidth) posX = 0;  
  wrapper.style.transform = `translateX(${posX}px)`;  
  requestAnimationFrame(animate);  
}  
animate();  

// Mouse drag  
wrapper.addEventListener("mousedown", e => {  
  isDragging = true;  
  startX = e.pageX - posX;  
});  
wrapper.addEventListener("mousemove", e => {  
  if (!isDragging) return;  
  posX = e.pageX - startX;  
});  
wrapper.addEventListener("mouseup", () => isDragging = false);  
wrapper.addEventListener("mouseleave", () => isDragging = false);  

// Touch drag  
wrapper.addEventListener("touchstart", e => {  
  isDragging = true;  
  startX = e.touches[0].pageX - posX;  
});  
wrapper.addEventListener("touchmove", e => {  
  if (!isDragging) return;  
  posX = e.touches[0].pageX - startX;  
});  
wrapper.addEventListener("touchend", () => isDragging = false);  

// ---- Direct WhatsApp Click ----  
document.addEventListener("click", e => {  
  if (e.target.classList.contains("clickable-announcement")) {  
    const phone = e.target.dataset.phone;  
    const content = e.target.dataset.content;  
    const msg = `Hi, I saw your announcement: *${content}* on PickMe Services and I want to make enquiry on it.`;  
    const url = `https://wa.me/${phone.replace(/\D/g,'')}?text=${encodeURIComponent(msg)}`;  
    window.open(url, "_blank");  
  }
  // ---- Fix ‚ÄúClick HERE to add your announcement‚Äù ----
  if (e.target.classList.contains("flash-here")) {
    e.stopPropagation();  // prevent slider from breaking
    window.open(e.target.href, "_blank");
  }
});  

</script>
