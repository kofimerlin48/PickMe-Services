<!DOCTYPE html>
<html lang="en">
<head>

  <style>
/* Remove blue outline and tap highlight for clickable cards */
.card, .card a, .card button {
    outline: none;                  /* removes the blue focus outline */
    -webkit-tap-highlight-color: transparent;  /* removes the blue highlight on mobile */
}
</style>
  
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Event Listings</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 20px;
    }
    .search-bar {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      font-size: 16px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    .categories { display: flex; overflow-x: auto; gap: 10px; margin-bottom: 10px; padding-bottom: 5px; }
    .categories::-webkit-scrollbar { display: none; }
    .categories button {
      background: #ddd;
      border: none;
      padding: 8px 14px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      flex: 0 0 auto;
    }
    .categories button.active { background: #007bff; color: #fff; }
    .subcategories { display: flex; gap: 15px; margin-bottom: 20px; }
    .subcategories span { cursor: pointer; font-size: 14px; color: #555; }
    .subcategories span.active { color: #007bff; font-weight: bold; font-size: 16px; }

    .event-card {
      display: flex;
      flex-direction: row;
      background: #fff;
      border-radius: 12px;
      margin-bottom: 20px;
      overflow: hidden;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);
      position: relative;
    }
    .event-flyers { width: 40%; position: relative; cursor: pointer; z-index: 2; }
    .event-flyers img { width: 100%; display: block; }

    .event-info {
      flex: 1;
      padding: 15px;
      position: relative;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      color: #000;
      background-size: cover;
      background-position: center;
      background-blend-mode: lighten;
    }
    .event-info::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(255,255,255,0.8);
      backdrop-filter: blur(20px);
      z-index: 1;
    }
    .event-info > * { position: relative; z-index: 2; }

    .event-title { font-size: 20px; font-weight: bold; }
    @media(min-width:768px) { .event-title { font-size: 28px; } }
    .event-subtitle { font-size: 18px; font-weight: bold; color: #555; margin-bottom: 20px; }
    .event-organizer { font-size: 15px; color: #777; margin-bottom: 5px; }
    .event-date {
      position: absolute;
      right: 8px;
      bottom: 35px;   /* moved closer to countdown */
      text-align: center;
      font-weight: bold;
      color: #333;
    }
    .event-date .month { font-size: 14px; text-transform: uppercase; }
    .event-date .day { font-size: 20px; line-height: 1; color: #e63946; font-weight: bold; }
    .event-date .year { font-size: 14px; }

    .event-rate { margin: 10px 0; font-weight: bold; color: #333; }
    .contact-btn {
      padding: 8px 16px;
      background: #28a745;
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      width: max-content;
      margin-bottom: 5px;
    }
    .view-details { color: #007bff; cursor: pointer; font-size: 14px; text-decoration: underline; margin-top: 5px; display: inline-block; }

    .popup {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .popup-content {
      position: relative;
      border-radius: 12px;
      padding: 20px;
      color: #000;
      overflow: hidden;
      box-shadow: 0 6px 18px rgba(0,0,0,0.4);
      background: #fff;
    }
    .popup-text {
      position: relative;
      z-index: 2;
      background: #fff;
      padding: 15px;
      border-radius: 10px;
      white-space: pre-wrap;
      margin-top: 40px;
    }
    .popup-text h2 {
      font-weight: bold;
      color: #000;
      margin: 0;
    }
    .close-icon {
      position: absolute;
      top: 10px; right: 10px;
      width: 32px; height: 32px;
      background: #000;
      border-radius: 50%;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      z-index: 3;
    }

    /* keep buttons only, no card */
    .contact-buttons { display: flex; gap: 15px; z-index: 2; }
    .contact-buttons button {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      font-size: 16px;
    }
    #callBtn { background: #007bff; color: #fff; }
    #whatsappBtn { background: #28a745; color: #fff; }

    .countdown { position: absolute; bottom: 15px; right: 8px; font-size: 10px; font-weight: bold; color: #333; }
  </style>
</head>
<body>
  <input type="text" id="searchInput" class="search-bar" placeholder="Search events...">
  <div class="categories" id="categories"></div>
  <div class="subcategories" id="subcategories"></div>
  <div id="eventsContainer"></div>

  <!-- Contact Popup -->
  <div class="popup" id="contactPopup">
    <div>
      <span class="close-icon" onclick="closePopup('contactPopup')">×</span>
      <div class="contact-buttons">
        <button id="callBtn">Call</button>
        <button id="whatsappBtn">WhatsApp</button>
      </div>
    </div>
  </div>

  <!-- Flyer Preview Popup -->
  <div class="popup" id="flyerPopup">
    <div>
      <span class="close-icon" onclick="closePopup('flyerPopup')">×</span>
      <img id="flyerPreview" src="" alt="Flyer Preview" style="max-width:90vw;max-height:90vh;border-radius:12px;z-index:2;position:relative;">
    </div>
  </div>

  <!-- Event Details Popup -->
  <div class="popup" id="detailsPopup">
    <div class="popup-content" id="detailsContent">
      <span class="close-icon" onclick="closePopup('detailsPopup')">×</span>
      <div class="popup-text" id="detailsText"></div>
    </div>
  </div>

<script>
/* ======================
   EVENTS - edit dates here
   Accepts:
     - single:  "YYYY-MM-DD"
     - range:   "YYYY-MM-DD-DD"  (same month/year; startDay-endDay)
     - full range (optional): "YYYY-MM-DD-YYYY-MM-DD"
   ====================== */
const events = [
  {
    title: "AGOGO NA ME FRI",
    subtitle: "Season 26",
    organizer: "WOO ENTERTAINMENT",
    date: "2025-09-20",            // single
    rate: "Free",
    contact: { phone: "+233544373482", whatsapp: "233544373482" },
    flyers: ["https://lh3.googleusercontent.com/d/16isBtAvObv4kgPDC3-qcF0pRXo8aAdxI"],
    description: `FOR SPONSPRSHIP OR INQUIRY
CONTACT THE FOLLOWING NUMBERS:
0544373482
0545160557
0530780664
0533842398.`,
    category: "Entertainment"
  },
  {
    title: "ALL BLACK AFFAIR",
    subtitle: "With KWAKU FLICK",
    organizer: "MANKO PUB",
    date: "2025-10-28",        // range within same month
    rate: "FREE",
    contact: { phone: "+233246493422", whatsapp: "233246493422" },
    flyers: ["https://lh3.googleusercontent.com/d/16H0IOn0jeJTaZ5WkLnijVvvyKa3UAG0J"],
    description: `SIDE ATTRACTION:
FLOAT, FREE POPCORN PHOTOSHOOT
SHISHA STAND & GOOD MUSIC

MUSIC BY:
DJ CHARTO
DJ STANZA

HYPE BY:
MC NANI MOLE
MC ARMARNI KAY


FOR SPONSORSHIP, PLEASE CALL:
0246493422 / 0241819505
`,
    category: "Entertainment"
  },
  {
    title: "MASQUERADE TIPSY NIGHT",
    subtitle: "With KWAKU SMOKE",
    organizer: "Deliver Us From Evil",
    date: "2025-09-20-25",        // range within same month
    rate: "₵100",
    contact: { phone: "+233245959396", whatsapp: "+233245959396" },
    flyers: ["https://lh3.googleusercontent.com/d/15f6iEkGW4HUWPaCDHjfRizV2S6XnjOs5"],
    description: `A day filled with joy and much entertainment.
LOCATION: Abrantie`,
    category: "Entertainment"
  }
];

events.sort((a,b) => {
  // keep sort behavior (sort by start date)
  const pa = parseEventDates(a.date);
  const pb = parseEventDates(b.date);
  if(!pa || !pb) return 0;
  return pa.start - pb.start;
});

/* ---------- helpers ---------- */
function parseEventDates(dateStr) {
  // returns { start: Date, end: Date } or null
  if(!dateStr || typeof dateStr !== 'string') return null;
  const parts = dateStr.split('-').map(s => s.trim());
  try {
    if(parts.length === 3) {
      // YYYY MM DD
      const y = +parts[0], m = +parts[1]-1, d = +parts[2];
      const start = new Date(y,m,d); start.setHours(0,0,0,0);
      const end = new Date(y,m,d); end.setHours(23,59,59,999);
      return { start, end };
    } else if(parts.length === 4) {
      // YYYY MM D1 D2  (same month & year)
      const y = +parts[0], m = +parts[1]-1, d1 = +parts[2], d2 = +parts[3];
      const start = new Date(y,m,d1); start.setHours(0,0,0,0);
      const end = new Date(y,m,d2); end.setHours(23,59,59,999);
      return { start, end };
    } else if(parts.length === 6) {
      // YYYY MM DD YYYY MM DD
      const y1 = +parts[0], m1 = +parts[1]-1, d1 = +parts[2];
      const y2 = +parts[3], m2 = +parts[4]-1, d2 = +parts[5];
      const start = new Date(y1,m1,d1); start.setHours(0,0,0,0);
      const end = new Date(y2,m2,d2); end.setHours(23,59,59,999);
      return { start, end };
    } else {
      // fallback: try general Date parse for single date string
      const sd = new Date(dateStr);
      if(!isNaN(sd)) {
        const start = new Date(sd); start.setHours(0,0,0,0);
        const end = new Date(sd); end.setHours(23,59,59,999);
        return { start, end };
      }
    }
  } catch (e) {
    return null;
  }
  return null;
}

function formatDateSlot(start, end) {
  const monthNames = ["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"];
  if (!start || !end) return { month: '', dayText: '', year: '' };

  // Check if same calendar day (compare year, month, date)
  const sameDay = start.getFullYear() === end.getFullYear()
                && start.getMonth() === end.getMonth()
                && start.getDate() === end.getDate();

  if (sameDay) {
    return {
      month: monthNames[start.getMonth()],
      dayText: `${start.getDate()}`,
      year: `${start.getFullYear()}`
    };
  }

  // If same month & year => show day range e.g. "20-25"
  if (start.getFullYear() === end.getFullYear() && start.getMonth() === end.getMonth()) {
    return {
      month: monthNames[start.getMonth()],
      dayText: `${start.getDate()}-${end.getDate()}`,
      year: `${start.getFullYear()}`
    };
  }

  // Different months/years: show start month and a compact day-range (keeps UI consistent)
  return {
    month: monthNames[start.getMonth()],
    dayText: `${start.getDate()}-${end.getDate()}`,
    year: `${start.getFullYear()}`
  };
}

/* ---------- UI setup (unchanged) ---------- */
const categories = ["All", "Entertainment", "Gospel", "School", "Ceremonies", "Business", "Funeral", "Others"];
const subcategories = ["All", "Today", "This Week", "This Month"];

const catDiv = document.getElementById('categories');
categories.forEach(cat => {
  const btn = document.createElement('button');
  btn.textContent = cat;
  btn.onclick = () => filterEvents(cat);
  if(cat==="All") btn.classList.add('active');
  catDiv.appendChild(btn);
});

const subDiv = document.getElementById('subcategories');
subcategories.forEach((sub,i)=>{
  const span = document.createElement('span');
  span.textContent=sub;
  span.onclick=()=>filterSubcategory(sub);
  if(i===0) span.classList.add('active');
  subDiv.appendChild(span);
});

function closePopup(id){ document.getElementById(id).style.display='none'; }
document.querySelectorAll('.popup').forEach(p=>{
  p.addEventListener('click',e=>{
    if(e.target===p) p.style.display='none';
  });
});

const container = document.getElementById('eventsContainer');
let currentCategory = "All";

/* ---------- render (only minor changes: use parsed start/end and support ranges) ---------- */
function renderEvents(list){
  container.innerHTML='';
  const today = new Date(); today.setHours(0,0,0,0);

  list.forEach(ev=>{
    const pd = parseEventDates(ev.date);
    if(!pd) return;
    const start = pd.start;
    const end = pd.end;

    // skip past events (ended before today)
    if(end < today) return;

    const card = document.createElement('div');
    card.className='event-card';

    const flyerDiv = document.createElement('div');
flyerDiv.className = 'event-flyers';
flyerDiv.style.position = 'relative';
flyerDiv.style.overflow = 'hidden';
flyerDiv.style.display = 'flex';
flyerDiv.style.justifyContent = 'center';
flyerDiv.style.alignItems = 'center';
flyerDiv.style.borderRadius = '12px 0 0 12px';

// blurred background using pseudo div
if(ev.flyers && ev.flyers[0]){
  const bgBlur = document.createElement('div');
  bgBlur.style.backgroundImage = `url(${ev.flyers[0]})`;
  bgBlur.style.backgroundSize = 'cover';
  bgBlur.style.backgroundPosition = 'center';
  bgBlur.style.position = 'absolute';
  bgBlur.style.top = '0';
  bgBlur.style.left = '0';
  bgBlur.style.width = '100%';
  bgBlur.style.height = '100%';
  bgBlur.style.filter = 'blur(105px)';
  bgBlur.style.transform = 'scale(1.1)'; // avoid edges showing
  bgBlur.style.zIndex = '1';
  flyerDiv.appendChild(bgBlur);
}

// actual flyer image on top
const flyerImg = document.createElement('img');
flyerImg.src = ev.flyers && ev.flyers[0] ? ev.flyers[0] : '';
flyerImg.style.position = 'relative';
flyerImg.style.zIndex = '2';
flyerImg.style.maxWidth = '100%';
flyerImg.style.maxHeight = '100%';
flyerImg.style.borderRadius = '0px';

flyerDiv.onclick = () => {
  document.getElementById('flyerPreview').src = flyerImg.src;
  document.getElementById('flyerPopup').style.display = 'flex';
};

flyerDiv.appendChild(flyerImg);
card.appendChild(flyerDiv);

    const infoDiv = document.createElement('div');
    infoDiv.className='event-info';
    infoDiv.style.backgroundImage = ev.flyers && ev.flyers[0] ? `url(${ev.flyers[0]})` : '';

    const titleEl=document.createElement('div'); titleEl.className='event-title'; titleEl.textContent=ev.title;
    const subtitleEl=document.createElement('div'); subtitleEl.className='event-subtitle'; subtitleEl.textContent=ev.subtitle;
    const organizerEl=document.createElement('div'); organizerEl.className='event-organizer'; organizerEl.textContent=`By ${ev.organizer}`;
    const rateEl=document.createElement('div'); rateEl.className='event-rate'; rateEl.textContent=`Rate: ${ev.rate}`;

    const contactBtn=document.createElement('button'); contactBtn.className='contact-btn'; contactBtn.textContent='Contact Us';
    contactBtn.onclick=()=>{
      document.getElementById('contactPopup').style.display='flex';
      document.getElementById('callBtn').onclick=()=>window.location=`tel:${ev.contact.phone}`;
      document.getElementById('whatsappBtn').onclick=()=>window.open(`https://wa.me/${ev.contact.whatsapp}?text=Hi ${encodeURIComponent(ev.organizer)}, I want to enquire about ${encodeURIComponent(ev.title)}`,'_blank');
    };

    const viewDetails=document.createElement('span'); viewDetails.className='view-details'; viewDetails.textContent='View Details';
    viewDetails.onclick=()=>{
      const popup=document.getElementById('detailsPopup');
      const details=document.getElementById('detailsText');
      details.innerHTML = `<h2>Event Details</h2><br><br><br>${ev.description}`;

// Add Save button at the bottom of popup
const saveBtnPopup = document.createElement('div');
saveBtnPopup.textContent = "Save Event to Calendar";
saveBtnPopup.style.fontSize = "16px";
saveBtnPopup.style.padding = "8px 10px";
saveBtnPopup.style.borderRadius = "20px";
saveBtnPopup.style.background = "#28a745";
saveBtnPopup.style.color = "#fff";
saveBtnPopup.style.fontWeight = "bold";
saveBtnPopup.style.cursor = "pointer";
saveBtnPopup.style.textAlign = "center";
saveBtnPopup.style.marginTop = "20px";
saveBtnPopup.style.alignSelf = "center";

// Google Calendar click
saveBtnPopup.onclick = () => {
  const pd = parseEventDates(ev.date);
  if(!pd) return;
  const startDateStr = pd.start.toISOString().replace(/-|:|\.\d+/g,"");
  const endDateStr = pd.end.toISOString().replace(/-|:|\.\d+/g,"");
  const detailsText = `Organizer: ${ev.organizer}\nPhone: ${ev.contact.phone}\nWhatsApp: ${ev.contact.whatsapp}`;
  const calendarUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(ev.title + ' - ' + ev.subtitle)}&dates=${startDateStr}/${endDateStr}&details=${encodeURIComponent(detailsText)}&location=&sf=true&output=xml`;
  window.open(calendarUrl, '_blank');
};

document.getElementById('detailsText').appendChild(saveBtnPopup);
      popup.style.display='flex';
    };

    // date display (supports range)
    const dateEl=document.createElement('div'); 
dateEl.className='event-date';
const display = formatDateSlot(start, end);
dateEl.innerHTML=`<div class="month">${display.month}</div><div class="day">${display.dayText}</div><div class="year">${display.year}</div>`;

// Google Calendar click
dateEl.style.cursor = 'pointer';
dateEl.title = "Add to Google Calendar";
dateEl.onclick = () => {
  const startDateStr = pd.start.toISOString().replace(/-|:|\.\d+/g,"");
  const endDateStr = pd.end.toISOString().replace(/-|:|\.\d+/g,"");
  const details = `Organizer: ${ev.organizer}\nPhone: ${ev.contact.phone}\nWhatsApp: ${ev.contact.whatsapp}`;
  const calendarUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(ev.title + ' - ' + ev.subtitle)}&dates=${startDateStr}/${endDateStr}&details=${encodeURIComponent(details)}&location=&sf=true&output=xml`;
  window.open(calendarUrl, '_blank');
};

    // countdown / ongoing logic
    const countdown = document.createElement('div'); countdown.className='countdown';
    if(today < start){
      const diffDays = Math.ceil((start - today)/(1000*60*60*24));
      countdown.textContent = `${diffDays} Day${diffDays>1?'s':''} left`;
    } else if(today >= start && today <= end){
      countdown.textContent = 'Ongoing';
    }

    infoDiv.append(titleEl,subtitleEl,organizerEl,rateEl,contactBtn,viewDetails,dateEl);
    if(countdown.textContent) infoDiv.appendChild(countdown);
    card.appendChild(infoDiv);
    container.appendChild(card);
  });
}

/* ---------- filter logic: FIXED SUB-TABS (uses parsed start/end and checks overlap) ---------- */
function filterEvents(category){
  currentCategory = category;
  document.querySelectorAll('.categories button').forEach(btn=>btn.classList.remove('active'));
  [...catDiv.children].find(b=>b.textContent===category).classList.add('active');
  document.querySelectorAll('.subcategories span').forEach(s=>s.classList.remove('active'));
  [...subDiv.children][0].classList.add('active');
  filterSubcategory("All");
}

function filterSubcategory(sub){
  // only change in this function and related date parsing logic (everything else intact)
  document.querySelectorAll('.subcategories span').forEach(s=>s.classList.remove('active'));
  [...subDiv.children].find(s=>s.textContent===sub).classList.add('active');

  let baseEvents = (currentCategory==="All") ? events : events.filter(ev=>ev.category && ev.category.trim().toLowerCase()===currentCategory.trim().toLowerCase());

  const today = new Date(); today.setHours(0,0,0,0);

  if(sub === "Today"){
    baseEvents = baseEvents.filter(ev=>{
      const pd = parseEventDates(ev.date);
      if(!pd) return false;
      return (pd.start <= today && pd.end >= today);
    });
  } else if(sub === "This Week"){
    // week: Sunday -> Saturday
    const weekStart = new Date(today);
    weekStart.setDate(today.getDate() - today.getDay()); weekStart.setHours(0,0,0,0);
    const weekEnd = new Date(weekStart); weekEnd.setDate(weekStart.getDate() + 6); weekEnd.setHours(23,59,59,999);
    baseEvents = baseEvents.filter(ev=>{
      const pd = parseEventDates(ev.date);
      if(!pd) return false;
      // overlap check: event overlaps any day in the week
      return !(pd.end < weekStart || pd.start > weekEnd);
    });
  } else if(sub === "This Month"){
    const monthStart = new Date(today.getFullYear(), today.getMonth(), 1); monthStart.setHours(0,0,0,0);
    const monthEnd = new Date(today.getFullYear(), today.getMonth() + 1, 0); monthEnd.setHours(23,59,59,999);
    baseEvents = baseEvents.filter(ev=>{
      const pd = parseEventDates(ev.date);
      if(!pd) return false;
      return !(pd.end < monthStart || pd.start > monthEnd);
    });
  } else {
    // All -> no extra filter
  }

  renderEvents(baseEvents);
}

/* ---------- search: include month name matching (so typing 'sep' finds September events) ---------- */
document.getElementById('searchInput').addEventListener('input',e=>{
  const term = e.target.value.toLowerCase().trim();
  const monthNamesFull = ["january","february","march","april","may","june","july","august","september","october","november","december"];

  const results = events.filter(ev=>{
    const pd = parseEventDates(ev.date);
    const monthName = pd ? monthNamesFull[pd.start.getMonth()] : '';
    return (
      (ev.title && ev.title.toLowerCase().includes(term)) ||
      (ev.organizer && ev.organizer.toLowerCase().includes(term)) ||
      (ev.subtitle && ev.subtitle.toLowerCase().includes(term)) ||
      (ev.rate && ev.rate.toLowerCase().includes(term)) ||
      (ev.description && ev.description.toLowerCase().includes(term)) ||
      (ev.category && ev.category.toLowerCase().includes(term)) ||
      (ev.date && ev.date.toLowerCase().includes(term)) ||
      (monthName && monthName.includes(term))
    );
  });

  renderEvents(results);
});

/* ---------- initial load ---------- */
filterEvents("All");
</script>

  <div style="position:fixed; bottom:0; width:100%; z-index:9999;">
    <iframe src="footer.html" style="width:100%; height:60px; border:none; overflow:hidden;" scrolling="no"></iframe>
</div>

</body>

</html>
