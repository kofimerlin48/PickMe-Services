<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PickMe Services - Food</title>
    
    <!-- External Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Icons (Lucide) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Firebase SDKs (Compat version for Vanilla JS) -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    
    <!-- Google GenAI SDK (ESM Module for Browser) -->
    <script type="importmap">
      {
        "imports": {
          "@google/genai": "https://esm.sh/@google/genai@0.1.0"
        }
      }
    </script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/food/style.css">
</head>
<body>

    <!-- Header Placeholder -->
    <div id="header-placeholder"></div>

    <!-- MAIN APP CONTAINER -->
    <div id="app">
        <!-- Views will be injected here via JavaScript -->
        
        <!-- 1. HOME VIEW -->
        <div id="view-home" class="view active">
            <div class="container">
                <div class="header-row">
                    <div>
                        <h2 class="greeting" id="greeting-text">Good day üëã</h2>
                        <p class="subtitle">Ready to explore delicious options?</p>
                    </div>
                    <button class="btn-partner-access" onclick="openPartnerModal()">
                        Add your Restaurant <i data-lucide="arrow-right"></i>
                    </button>
                </div>

                <!-- Drinks Banner -->
                <div class="banner-drinks">
                    <div class="banner-content">
                        <div class="icon-box"><i data-lucide="wine"></i></div>
                        <div>
                            <h3>Thirsty? Order Drinks üçπ</h3>
                            <p>Premium beverages delivered ice cold.</p>
                        </div>
                    </div>
                    <div class="arrow-circle"><i data-lucide="arrow-right"></i></div>
                </div>

                <h3 class="section-title"><i data-lucide="map-pin"></i> Nearby Restaurants</h3>
                
                <!-- Restaurant Grid -->
                <div id="restaurant-grid" class="grid">
                    <!-- JS will populate this -->
                </div>

                <!-- Partner Banner Bottom -->
                <div id="partner-section" class="banner-partner">
                    <div class="glow-effect"></div>
                    <div class="content">
                        <div>
                            <h3>Own a Restaurant?</h3>
                            <p>Join PickMe Services to reach more customers.</p>
                        </div>
                        <button class="btn-white" onclick="openPartnerModal()">
                            <i data-lucide="chef-hat"></i> Add your Restaurant
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 2. RESTAURANT VIEW -->
        <div id="view-restaurant" class="view">
            <div class="sticky-header">
                <button class="btn-back" onclick="setView('home')">
                    <i data-lucide="chevron-left"></i> Back to Restaurants
                </button>
                <span id="sticky-rest-name" class="header-title">Restaurant Name</span>
            </div>
            
            <div class="container restaurant-container">
                <div class="restaurant-hero">
                    <img id="rest-hero-img" src="" alt="">
                    <div class="rest-info">
                        <h1 id="rest-name">Restaurant Name</h1>
                        <p id="rest-cuisine">Cuisine</p>
                        <div class="tags">
                            <span class="tag-rating"><i data-lucide="star"></i> <span id="rest-rating">0.0</span> Excellent</span>
                            <span class="tag-delivery">Delivery: GHS <span id="rest-fee">0</span></span>
                        </div>
                    </div>
                </div>

                <h2 class="section-title">Menu</h2>
                <div id="menu-grid" class="grid-2">
                    <!-- JS populates menu -->
                </div>
            </div>
        </div>

        <!-- 3. CART VIEW -->
        <div id="view-cart" class="view">
            <div class="container cart-container">
                <div class="cart-header">
                    <div class="left">
                        <button class="btn-back-circle" onclick="goBackFromCart()">
                            <i data-lucide="chevron-left"></i>
                        </button>
                        <h2>Your Cart</h2>
                    </div>
                    <button id="btn-clear-cart" class="text-danger" onclick="promptClearCart()">Clear Cart</button>
                </div>

                <div id="cart-empty" class="empty-state hidden">
                    <div class="icon-circle"><i data-lucide="shopping-bag"></i></div>
                    <h3>Your cart is empty</h3>
                    <p>Looks like you haven't made your choice yet.</p>
                    <button class="btn-primary" onclick="setView('home')">Start Ordering</button>
                </div>

                <div id="cart-items-list" class="cart-list">
                    <!-- JS populates cart items -->
                </div>
            </div>

            <!-- Cart Footer (Checkout Bar) -->
            <div id="cart-footer" class="fixed-bottom hidden">
                <div class="container flex-between">
                    <div>
                        <p class="label">Total</p>
                        <p class="price-large">GHS <span id="cart-total-display">0.00</span></p>
                    </div>
                    <button class="btn-black" onclick="initiateCheckout(true)">Pay for all meals</button>
                </div>
            </div>
        </div>

    </div>

    <!-- === MODALS === -->

    <!-- 1. Meal Customizer Modal -->
    <div id="modal-meal" class="modal-overlay hidden" onclick="closeMealModal()">
        <div class="modal-bottom-sheet" onclick="event.stopPropagation()">
            <div class="meal-header-img">
                <img id="modal-meal-img" src="" alt="">
                <div class="overlay"></div>
                <div class="top-nav">
                    <button id="btn-modal-back" class="btn-glass hidden" onclick="setMealView('SELECTION')"><i data-lucide="arrow-left"></i></button>
                    <button class="btn-glass" onclick="closeMealModal()"><i data-lucide="x"></i></button>
                </div>
                <div class="meal-title-float">
                    <h2 id="modal-meal-name">Meal Name</h2>
                </div>
            </div>

            <div class="modal-body">
                <!-- View: Selection (Slider) -->
                <div id="meal-view-selection" class="meal-view">
                    <div class="view-title"><h3>Choose Option</h3></div>
                    <div class="horizontal-scroll" id="package-slider">
                        <!-- JS injects packages -->
                    </div>
                </div>

                <!-- View: Config (Package/Standard) -->
                <div id="meal-view-config" class="meal-view hidden">
                    <div class="config-header">
                        <h3 id="config-title">Standard</h3>
                        <div class="price-tag" id="config-price">GHS 0.00</div>
                    </div>
                    <p id="config-desc" class="desc-text"></p>
                    <div id="config-options" class="options-list"></div>
                </div>

                <!-- View: Builder (Custom) -->
                <div id="meal-view-builder" class="meal-view hidden">
                    <div class="builder-header">
                        <div class="flex-between">
                            <h4 id="builder-unit-name">Bowl</h4>
                            <span class="highlight">GHS <span id="builder-base-price">0</span> / unit</span>
                        </div>
                        <div class="qty-control">
                            <button onclick="updateBuilderBaseQty(-1)"><i data-lucide="minus"></i></button>
                            <span id="builder-qty-display">1</span>
                            <button onclick="updateBuilderBaseQty(1)"><i data-lucide="plus"></i></button>
                        </div>
                    </div>
                    <div id="builder-addons" class="options-list"></div>
                </div>
            </div>

            <div id="meal-footer" class="modal-footer hidden">
                <!-- Qty for non-builder -->
                <div id="footer-qty-control" class="flex-between mb-3">
                    <span class="label">Quantity</span>
                    <div class="qty-pill">
                        <button onclick="updateMealQty(-1)"><i data-lucide="minus"></i></button>
                        <span id="meal-qty-display">1</span>
                        <button onclick="updateMealQty(1)"><i data-lucide="plus"></i></button>
                    </div>
                </div>
                <button id="btn-add-to-cart" class="btn-primary flex-between" onclick="confirmAddToCart()">
                    <span id="btn-add-text">Add to Order</span>
                    <span id="btn-add-price">GHS 0.00</span>
                </button>
            </div>
        </div>
    </div>

    <!-- 2. Checkout Modal -->
    <div id="modal-checkout" class="modal-overlay hidden">
        <div class="modal-center" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="flex-align">
                    <i data-lucide="receipt" class="text-primary"></i>
                    <h3 id="checkout-title">Delivery Details</h3>
                </div>
                <button class="btn-icon" onclick="closeCheckoutModal()"><i data-lucide="x"></i></button>
            </div>
            
            <div class="modal-content custom-scrollbar">
                <!-- Step 1: Form -->
                <div id="checkout-step-1" class="step-view">
                    <label>PAYER INFORMATION</label>
                    <input type="text" id="pay-name" class="input-field" placeholder="Full Name">
                    <div class="input-group">
                        <input type="tel" id="pay-momo" class="input-field" placeholder="Mobile Money Number" maxlength="10" oninput="detectNetwork(this.value, 'checkout')">
                        <div id="pay-network-badge" class="badge hidden"><i data-lucide="wallet"></i> <span></span></div>
                    </div>

                    <label>DELIVERY LOCATION</label>
                    <div class="input-icon">
                        <i data-lucide="map-pin"></i>
                        <input type="text" id="del-address" class="input-field" placeholder="Address / Landmark">
                    </div>
                    <div class="input-icon">
                        <i data-lucide="phone"></i>
                        <input type="tel" id="del-contact" class="input-field" placeholder="Contact Phone" maxlength="10">
                    </div>
                </div>

                <!-- Step 2: Summary -->
                <div id="checkout-step-2" class="step-view hidden">
                    <div class="summary-card">
                        <div class="row"><span>Meal Total</span><span id="sum-subtotal">GHS 0.00</span></div>
                        <div class="row"><span>Delivery Fee</span><span id="sum-delivery">GHS 0.00</span></div>
                        <div class="row"><span>Service Charge</span><span id="sum-service">GHS 2.00</span></div>
                        <div class="row total"><span>Total Amount</span><span id="sum-total" class="text-primary">GHS 0.00</span></div>
                    </div>
                    <div class="info-box">
                        <p><strong>Deliver to:</strong> <span id="conf-address"></span></p>
                        <p><strong>Contact:</strong> <span id="conf-contact"></span></p>
                        <p><strong>Payer:</strong> <span id="conf-payer"></span></p>
                    </div>
                </div>
            </div>

            <div class="modal-footer-simple">
                <button id="btn-checkout-next" class="btn-black full" onclick="checkoutNext()">Continue <i data-lucide="arrow-right"></i></button>
                <div id="btn-group-pay" class="flex-gap hidden">
                    <button class="btn-grey" onclick="checkoutBack()">Back</button>
                    <button id="btn-make-payment" class="btn-primary flex-1" onclick="processPayment()">Make Payment</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 3. Clear Cart Modal -->
    <div id="modal-clear-cart" class="modal-overlay hidden">
        <div class="modal-center small text-center">
            <div class="icon-circle-red"><i data-lucide="trash-2"></i></div>
            <h3>Clear entire cart?</h3>
            <p>Are you sure you want to remove all items?</p>
            <div class="flex-gap mt-4">
                <button class="btn-grey flex-1" onclick="document.getElementById('modal-clear-cart').classList.add('hidden')">Cancel</button>
                <button class="btn-danger flex-1" onclick="clearCart()">Yes, Clear All</button>
            </div>
        </div>
    </div>

    <!-- 4. Partner Onboarding Modal -->
    <div id="modal-partner" class="modal-overlay hidden">
        <div class="modal-center full-height-mobile">
            <div class="modal-header">
                <div class="flex-align text-primary">
                    <i data-lucide="chef-hat"></i>
                    <h3>Partner Portal</h3>
                </div>
                <button class="btn-icon" onclick="closePartnerModal()"><i data-lucide="x"></i></button>
            </div>
            
            <div class="modal-content custom-scrollbar" id="partner-content">
                <!-- Content injected dynamically via JS based on state -->
            </div>
        </div>
    </div>

    <!-- === FLOATING ELEMENTS === -->
    
    <!-- AI Assistant -->
    <div id="ai-widget" class="ai-container">
        <!-- Chat Window -->
        <div id="ai-chat-window" class="ai-window hidden">
            <div class="ai-header">
                <span><b>PickMe Chef</b></span>
                <button onclick="toggleAI()"><i data-lucide="x"></i></button>
            </div>
            <div id="ai-messages" class="ai-body custom-scrollbar">
                <!-- Msgs -->
            </div>
            <div class="ai-input-area">
                <input type="text" id="ai-input" placeholder="Type a message..." onkeydown="handleAIEnter(event)">
                <button onclick="sendAIMessage()"><i data-lucide="send"></i></button>
            </div>
        </div>
        
        <!-- Floating Button -->
        <button id="btn-ai-float" class="btn-ai-float" onclick="toggleAI()">
            <i data-lucide="message-circle"></i>
            <span class="label">PickMe Chef</span>
        </button>
    </div>

    <!-- Cart Floating Button (Top Right) -->
    <button id="float-cart-btn" class="float-cart" onclick="setView('cart')">
        <div class="rel">
            <i data-lucide="shopping-bag"></i>
            <span id="cart-count-badge" class="badge hidden">0</span>
        </div>
        <span class="label">Cart</span>
    </button>

    <!-- Cart Bottom Bar (Replaces float button when items exist) -->
    <div id="bottom-cart-bar" class="bottom-cart-bar hidden" onclick="setView('cart')">
        <span id="bar-count">0 items.</span>
        <span id="bar-total">GHS 0.00</span>
    </div>

    <!-- Scroll Helper -->
    <button id="scroll-helper" class="scroll-helper hidden" onclick="handleScrollClick()">
        <i data-lucide="arrow-down" id="scroll-icon"></i>
    </button>

    <!-- Notification Toast -->
    <div id="toast" class="toast hidden">
        <div class="dot"></div>
        <span id="toast-msg">Notification</span>
    </div>

    <!-- Footer Placeholder -->
    <div class="footer-wrap">
        <iframe src="footer.html" style="width:100%;height:60px;border:none;overflow:hidden" scrolling="no"></iframe>
    </div>

    <!-- Scripts -->
    <script src="/food/script.js"></script>
</body>
</html>
